fade_out 0.7
bg null

say "char_name/none" "date/say_0"

generate_date
if date_location == 0
  bg3d "parque"
  date_location_name "location/park"
  play_music "date1_intro" "date1_loop"
endif
if date_location == 1
  bg3d "shopping"
  date_location_name "location/shopping"
  play_music "date2_intro" "date2_loop"
endif

set_var currentDateEvent 0
set_var date_success 0

set_screen "date"

//wait 0.5
//show_date_ui true
fade_in 0.7

if tutorial_date == 0
  goto_script "tutorial_date"
endif


waypoint new_event
if currentDateEvent < #dateLength

waypoint start_interaction
set_screen "date_challenge"
wait 0.6
goto_script "\currentEventName" event_statement


if tutorial_date2 == 0
  goto_script "tutorial_date2"
endif


set_var currentPlayerTurn 0


waypoint new_player_turn

set_var resolution 0


// wait for action input
action_input


wait 0.5
character_action currentPlayerTurn
//wait 2.5

//resolve_action selected_attribute

if selected_attribute == 0
  goto_script "\currentEventName" guts_action
endif
if selected_attribute == 1
  goto_script "\currentEventName" intelligence_action
endif
if selected_attribute == 2
  goto_script "\currentEventName" charisma_action
endif
if selected_attribute == 3
  goto_script "\currentEventName" magic_action
endif


// if oponent is defeated, go to new event
if #currentChallengeHp <= 0
  goto_script "\currentEventName" defeated
  add_var currentDateEvent 1
  set_screen "date"
  wait 0.5
  add_var date_success 1
  challenge_result true
  update_ui
  play_sfx "ui_success"
  wait 2
  goto new_event
endif


/// go to next player turn
add_var currentPlayerTurn 1
if currentPlayerTurn < #partyLength
  goto new_player_turn
else
  // enemy turn
  set_var currentPlayerTurn 0
  enemy_attack
  if enemyAttackTargetId == 0
    goto_script "\currentEventName" attack_boy
  else
    goto_script "\currentEventName" attack_girl
  endif
  
  if #currentHp <= 0
    say "SUA PARTY FOI DERROTADA!"
    challenge_result false
    update_ui
    play_sfx "ui_fail"
    wait 2
    goto fail_date
  endif
  goto new_player_turn
endif



endif




waypoint win_date
set_screen "date"
say "char_name/none" "date/say_4"
// show_date_ui false

// set_screen "hide_all"
fade_music 0 0.5
show_engagement
fade_music 1 1
say "date/say_5"
//set_screen "date"
goto end


waypoint fail_date
set_screen "date"
say "char_name/none" "date/say_6"
// show_date_ui false
goto end



waypoint end
goto_script "pass_time"
