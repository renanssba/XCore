fade_out 0.7
bg null
say "char_name/none" "date/say_0"

generate_date
goto_script "set_date_location"
play_music "battle1_intro" "battle1_loop"

set_var currentDateEvent 0
theater_animation "setup_date"
set_screen "date"
enable_input true
set_current_character_turn -1

fade_in 0.7


theater_animation "party_enters"
wait 0.7

/// DATE TUTORIAL (?)
// if tutorial_date == 0
  // goto_script "tutorial_date"
// endif


for currentDateEvent #dateLength
  waypoint new_enemy_appears
  theater_animation "enemy_enters"
  wait 0.7
  goto_script "\currentEventName" event_statement


  // if tutorial_date2 == 0
    // goto_script "tutorial_date2"
  // endif


  waypoint start_new_turn  
  
  // end turn (to pass time on status conditions and take poison damage)
  end_turn
  if #currentHp <= 0
    goto fail_date
  endif
  

  // character action inputs
  for currentPlayerTurn #partyLength
    action_input currentPlayerTurn
  endfor
  
  set_current_character_turn -1
  wait 0.5

  // execute player actions
  for currentPlayerTurn #partyLength
    character_action_description currentPlayerTurn
    character_action currentPlayerTurn
    wait 0.5
  endfor
  
  // if oponent is defeated, go to new event
  if #currentChallengeHp <= 0
    goto_script "\currentEventName" defeated
    theater_animation "enemy_leaves"
    wait 0.7
    challenge_result true
    update_ui
    play_sfx "ui_success"
    wait 2
    continue
  endif


  // enemy turn
  set_var currentPlayerTurn 0
  enemy_attack_description
  enemy_attack

  if #currentHp <= 0
    goto fail_date
  endif
  
  goto start_new_turn
endfor




waypoint win_date
enable_input false
say "char_name/none" "date/say_4"
// show_date_ui false

fade_music 0 0.5
show_engagement
fade_music 1 1
say "date/say_5"
goto end


waypoint fail_date
//say "SUA EQUIPE FOI DERROTADA!"
challenge_result false
update_ui
play_sfx "ui_fail"
wait 2
enable_input false
say "char_name/none" "date/say_6"
// show_date_ui false
goto end



waypoint end
goto_script "pass_time"
