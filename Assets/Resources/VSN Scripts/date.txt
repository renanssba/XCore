fade_out 0.7
bg null
say "char_name/none" "date/say_0"

generate_date
goto_script "set_date_location"

set_screen "date"
set_current_character_turn -1

//wait 0.5
//show_date_ui true
fade_in 0.7


/// DATE TUTORIAL (?)
// if tutorial_date == 0
  // goto_script "tutorial_date"
// endif


for currentDateEvent #dateLength
  set_screen "date_challenge"
  wait 0.6
  goto_script "\currentEventName" event_statement


  if tutorial_date2 == 0
    goto_script "tutorial_date2"
  endif


  waypoint start_new_turn

  // character action inputs
  for currentPlayerTurn #partyLength
    action_input currentPlayerTurn
  endfor
  
  set_current_character_turn -1
  wait 0.5

  // execute player actions
  for currentPlayerTurn #partyLength
    character_action currentPlayerTurn
    if selected_attribute == 0
      goto_script "\currentEventName" guts_action
    endif
    if selected_attribute == 1
      goto_script "\currentEventName" intelligence_action
    endif
    if selected_attribute == 2
      goto_script "\currentEventName" charisma_action
    endif
    if selected_attribute == 3
      goto_script "\currentEventName" magic_action
    endif
    wait 0.5
    
    // if oponent is defeated, stop attacking
    if #currentChallengeHp <= 0
      break
    endif
  endfor  
  
  // if oponent is defeated, go to new event
  if #currentChallengeHp <= 0
    goto_script "\currentEventName" defeated
    set_screen "date"
    wait 0.5
    challenge_result true
    update_ui
    play_sfx "ui_success"
    wait 2
    continue
  endif


  // enemy turn
  set_var currentPlayerTurn 0
  enemy_attack
  if enemyAttackTargetId == 0
    goto_script "\currentEventName" attack_boy
  else
    goto_script "\currentEventName" attack_girl
  endif

  if #currentHp <= 0
    say "SUA PARTY FOI DERROTADA!"
    challenge_result false
    update_ui
    play_sfx "ui_fail"
    wait 2
    goto fail_date
  endif
  goto start_new_turn
endfor




waypoint win_date
set_screen "date"
say "char_name/none" "date/say_4"
// show_date_ui false

// set_screen "hide_all"
fade_music 0 0.5
show_engagement
fade_music 1 1
say "date/say_5"
//set_screen "date"
goto end


waypoint fail_date
set_screen "date"
say "char_name/none" "date/say_6"
// show_date_ui false
goto end



waypoint end
goto_script "pass_time"
