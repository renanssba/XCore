set_var currentDateEvent 0
setup_battle

fade_out 0.5
bg null

play_music "" "XCore1 Boss Theme"

theater_animation "setup_battle"

// move_camera "far_view" 0
move_camera "battle_view" 0

set_screen "battle"
enable_input true
set_current_character_turn -1

fade_in 0.5



/// START THE FIGHT

goto_script "check_passive_triggers" "battle_started"

// PARTY MEMBERS receive effects from conditions (like take poison damage)
// for currentBattlerTurn #battlersLength
  // for currentStatusCondition #currentPlayerStatusConditionsCount
    // activate_status_condition_effect currentBattlerTurn currentStatusCondition
  // endfor
// endfor

// ENEMY receives effects from conditions
// for currentStatusCondition #currentEnemyStatusConditionsCount
  // activate_status_condition_effect 3 currentStatusCondition
// endfor
// end turn (to pass time on status conditions)
// end_turn

// goto_script "check_passive_triggers" "before_death_checks"

/// TODO: check if all the party members are dead and end battle
// if #currentHp <= 0
  // goto end
// endif


// character turns
for currentBattlerTurn #battlersLength

  /// Ask for action input
  action_input currentBattlerTurn
  
  check_action_skip currentBattlerTurn
  goto_script "check_passive_triggers" "before_action"
  character_action currentBattlerTurn
  goto_script "check_passive_triggers" "after_action"
  wait 0.5
  
  // if enemy is defeated, end battle
  if #currentEnemyHp <= 0
    goto end
    goto_script "check_passive_triggers" "enemy_defeated"
  endif
endfor


// enemy turn
set_var currentBattlerTurn 0
enemy_attack_target
goto_script "check_passive_triggers" "before_enemy_attack"
enemy_attack
goto_script "check_passive_triggers" "after_enemy_attack"


// goto_script "check_passive_triggers" "before_death_checks"
goto end

// END THE FIGHT



waypoint end
enable_input false
fade_music 0 1
fade_out 0.5

end_battle
set_screen "tactical_view"

bg null
fade_in 0.5
